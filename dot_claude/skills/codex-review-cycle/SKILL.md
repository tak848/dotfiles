---
name: codex-review-cycle
description: >
  Codex CLI を使ったレビューサイクル。
  レビュー → 修正 → 同一セッション再レビュー → OK → 新セッションで別視点レビュー。
  確証バイアスを避けるため、承認後は必ず新セッションでレビューする。
  コード実装後のレビューや、設計レビューに使用する。
---

# Codex Review Cycle

## 重要な原則

- **情報をサボらず渡す**: codex-review エージェントは独立したコンテキストで動作する。Codex は空の状態で起動する。設計意図・制約・背景・関連ドキュメントのファイルパス・対象ファイルパスを全て渡すこと。
- **情報をサボらず受け取る**: エージェントの出力は全文読む。要約を求めない。
- **レビュー結果は鵜呑みにしない**: あなたは Codex が持たない背景情報を持っている。指摘の妥当性を判断し、的外れな指摘には反論する。誤解を招く書き方が原因なら改善する。
- **自分の知識も疑え**: あなた自身が知らない記法・構文が実際には正しく動作している場合がある。リポジトリ固有のルールや規約が存在する場合がある。API やオプションが非推奨になっていたり、新しく追加されていたりする場合がある。Codex の指摘を評価するとき、自分の思い込みで「この指摘は正しい/間違っている」と断定しないこと。判断に迷ったら一次ソースで裏付けを取ること。

## サイクル

### Phase 1: 初回レビュー

1. codex-review エージェントを Task ツールで呼び出す。以下を全て渡す:
   - **目的**: 何を達成しようとしているか
   - **制約**: 技術的・ビジネス的な制約
   - **対象ファイルパス**: レビュー対象（cwd 配下）
   - **必読資料パス**: 設計書・仕様書・steering 等の MD ファイルパス（cwd 配下。Codex が直接読める）
   - **レビュー依頼内容**: 具体的に何をレビューしてほしいか
2. 結果と thread_id を受け取る（エージェントの出力は全文読む）

### Phase 2: レビュー評価と修正

3. レビュー指摘の妥当性を判断する:
   - **妥当な指摘** → 修正（自分で行うか、適切なエージェントに委譲）
   - **的外れな指摘** → Codex に反論（同一セッションで resume）。反論理由を明確にする。
   - **判断に迷う** → ユーザーに確認
   - **誤解を招く書き方が原因** → コードやドキュメントを改善

### Phase 3: 同一セッションで再レビュー

4. codex-review エージェントを thread_id 付きで再呼び出し。修正内容と前回未解決事項を渡す。
5. まだ指摘あり → Phase 2 に戻る
6. 承認（指摘なし）→ Phase 4 へ

### Phase 4: 新セッションで別視点レビュー（確証バイアス回避）

7. codex-review エージェントを thread_id **なし**で呼び出し（新セッション）
   - 初回とは異なる観点を指定する（例: 初回がバグ・ロジック中心なら、最終は設計・保守性・エッジケース中心）
8. 新しい指摘あり → Phase 2 に戻る（新しい thread_id で）
9. 承認 → 完了。ユーザーに結果を報告する。
